<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture"
        Height="720" Width="1060"
        Background="{DynamicResource BgBrush}"
        Foreground="{DynamicResource TextSecondaryBrush}"
        FontFamily="Segoe UI"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        SourceInitialized="Window_SourceInitialized">

  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TabControl Grid.Row="0">
      <!-- Capture tab -->
      <TabItem Header="Capture">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Controls -->
          <Border Grid.Row="0"
                  Background="{DynamicResource CardBrush}"
                  BorderBrush="{DynamicResource InputBorderBrush}"
                  BorderThickness="1"
                  CornerRadius="{DynamicResource CardRadius}"
                  Padding="10">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- Column 1 -->
              <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                <TextBlock Text="Server:" Margin="2,2,0,2"/>
                <TextBox x:Name="ServerBox" Width="260"/>
                <TextBlock Text="Tribe:" Margin="16,2,0,2"/>
                <TextBox x:Name="TribeBox" Width="220"/>
                <Button x:Name="StartBtn" Content="Start" Click="StartBtn_Click" Style="{DynamicResource SecondaryButton}" Margin="16,0,0,0"/>
                <Button x:Name="StopBtn" Content="Stop" Click="StopBtn_Click" Style="{DynamicResource SecondaryButton}" Margin="6,0,0,0"/>
                <Button x:Name="SelectCropBtn" Content="Select Log Area…" Click="SelectCropBtn_Click" Style="{DynamicResource SecondaryButton}" Margin="6,0,0,0"/>
              </StackPanel>

              <!-- Column 2 -->
              <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8" HorizontalAlignment="Right">
                <Button x:Name="OcrCropBtn" Content="OCR Crop → Paste" Click="OcrCropBtn_Click" Style="{DynamicResource SecondaryButton}"/>
                <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click" Style="{DynamicResource SecondaryButton}" Margin="6,0,0,0"/>
                <Button x:Name="SendParsedBtn" Content="Send Pasted Log Line" Click="SendParsedBtn_Click" Style="{DynamicResource SecondaryButton}" Margin="6,0,0,0"/>
              </StackPanel>
            </Grid>
          </Border>

          <!-- Filters -->
          <Border Grid.Row="1" Margin="0,10,0,0"
                  Background="{DynamicResource CardBrush}"
                  BorderBrush="{DynamicResource InputBorderBrush}"
                  BorderThickness="1"
                  CornerRadius="{DynamicResource CardRadius}"
                  Padding="10">
            <StackPanel Orientation="Horizontal" Spacing="16">
              <TextBlock Text="Filters (session only):" Margin="0,2,0,2"/>
              <CheckBox x:Name="FilterTameDeaths" Content="Tame deaths"/>
              <CheckBox x:Name="FilterTamesStarving" Content="Tames starving to death"/>
              <CheckBox x:Name="FilterStructDestroyed" Content="Structures destroyed"/>
              <CheckBox x:Name="FilterStructAutoDecay" Content="Structures auto decay"/>
              <CheckBox x:Name="FilterTribeMateDeaths" Content="Tribemate deaths"/>
              <CheckBox x:Name="FilterTribeKillsEnemyTames" Content="Tribe kills enemy tames"/>
              <CheckBox x:Name="FilterEnemyPlayerKills" Content="Enemy player kills"/>
              <CheckBox x:Name="FilterTribeDemolish" Content="Tribemates demolishing structures"/>
              <CheckBox x:Name="FilterTribeFreezeTames" Content="Tribemates freezing tames"/>
            </StackPanel>
          </Border>

          <!-- Live preview + paste -->
          <Grid Grid.Row="2" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*"/>
              <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Preview -->
            <Border Grid.Column="0"
                    Background="{DynamicResource CardBrush}"
                    BorderBrush="{DynamicResource InputBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="{DynamicResource CardRadius}"
                    Padding="10">
              <Grid>
                <Image x:Name="LivePreview" Stretch="Uniform"/>
              </Grid>
            </Border>

            <!-- Paste box -->
            <Border Grid.Column="1" Margin="10,0,0,0"
                    Background="{DynamicResource CardBrush}"
                    BorderBrush="{DynamicResource InputBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="{DynamicResource CardRadius}"
                    Padding="10">
              <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                  <TextBlock Text="API echo:"/>
                  <TextBlock x:Name="ApiEchoText" Foreground="#9ECFFF"/>
                </StackPanel>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                  <TextBox x:Name="LogLineBox" AcceptsReturn="True" FontFamily="Consolas"
                           Foreground="#EEEEEE" Background="#111214" BorderThickness="0"
                           HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"/>
                </ScrollViewer>
              </DockPanel>
            </Border>
          </Grid>
        </Grid>
      </TabItem>

      <!-- Settings tab -->
      <TabItem Header="Settings">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <TextBlock Grid.Row="0" Grid.ColumnSpan="3" Text="API credentials" FontWeight="Bold" Margin="0,0,0,8"/>
          <TextBlock Grid.Row="1" Grid.Column="0" Text="Channel ID:" Margin="0,2,8,2"/>
          <TextBox   Grid.Row="1" Grid.Column="1" x:Name="ChannelBox" Width="320"/>
          <TextBlock Grid.Row="2" Grid.Column="0" Text="API URL:" Margin="0,2,8,2"/>
          <TextBox   Grid.Row="2" Grid.Column="1" x:Name="ApiUrlBox" Width="420"/>
          <TextBlock Grid.Row="3" Grid.Column="0" Text="API Key:" Margin="0,2,8,2"/>
          <PasswordBox Grid.Row="3" Grid.Column="1" x:Name="ApiKeyBox" Width="420"/>

          <StackPanel Grid.Row="3" Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Bottom">
            <Button x:Name="SaveBtn" Content="Save" Click="SaveBtn_Click" Style="{DynamicResource SecondaryButton}"/>
          </StackPanel>
        </Grid>
      </TabItem>
    </TabControl>

    <!-- STATUS -->
    <DockPanel Grid.Row="1" Margin="0,10,0,0">
      <TextBlock x:Name="StatusText" Foreground="#9ECFFF"/>
    </DockPanel>
  </Grid>
</Window>

