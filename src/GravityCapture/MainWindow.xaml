<Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="av"
  x:Class="GravityCapture.MainWindow"
  Title="Gravity Capture"
  MinWidth="820" MinHeight="920"
  MaxWidth="820" MaxHeight="920"
  Background="{x:Null}"
  Loaded="Window_Loaded"
  Closing="Window_Closing"
  SourceInitialized="Window_SourceInitialized"
  SizeChanged="Window_SizeChanged"
  HorizontalContentAlignment="Stretch"
  VerticalContentAlignment="Stretch">

  <Grid Background="#FF16191F">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- TabControl -->
    <TabControl SelectionChanged="TabControl_SelectionChanged"
                SelectedIndex="0"
                IsSynchronizedWithCurrentItem="True"
                Padding="0"
                BorderThickness="0"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Height="800">

      <!-- ======================= Capture ======================= -->
      <TabItem Header="Capture"
               FontFamily="Microsoft YaHei UI"
               Background="#FF2B2F36"
               FontWeight="Bold"
               Padding="0"
               SnapsToDevicePixels="True">
        <TabItem.Effect><DropShadowEffect/></TabItem.Effect>

        <!-- Capture layout: Banner, Toolbar, Content -->
        <Grid>
          <Grid.Background>
            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
              <GradientStop Color="Black"/>
              <GradientStop Color="#FF16191F" Offset="0.412"/>
            </LinearGradientBrush>
          </Grid.Background>

          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Banner -->
            <RowDefinition Height="Auto"/>  <!-- Toolbar -->
            <RowDefinition Height="*"/>     <!-- Content -->
          </Grid.RowDefinitions>

          <!-- Banner -->
          <Border Grid.Row="0" Width="820" VerticalAlignment="Bottom">
            <Image Height="56" Margin="12,6" Stretch="Uniform"
                   Source="Assets/Gravity_Capture_App_Banner.png"/>
          </Border>

          <!-- Toolbar -->
          <Border Grid.Row="1" Width="820" VerticalAlignment="Bottom">
            <WrapPanel ItemHeight="32" VerticalAlignment="Top" Height="104">
              <TextBlock Text="Server" Margin="9,0,9,0" Foreground="Red"
                         FontFamily="Microsoft YaHei UI" FontSize="14" Height="22" VerticalAlignment="Bottom">
                <TextBlock.Effect><DropShadowEffect/></TextBlock.Effect>
              </TextBlock>
              <TextBox x:Name="ServerBox" Width="320" Margin="9,0,9,0"
                       TextChanged="ServerBox_TextChanged" Height="28" Background="Black"
                       VerticalContentAlignment="Center" VerticalAlignment="Bottom">
                <TextBox.Effect><DropShadowEffect/></TextBox.Effect>
              </TextBox>

              <TextBlock Text="Tribe" Margin="9,0,9,0" Foreground="Red"
                         FontFamily="Microsoft YaHei UI" FontSize="14" Height="22" VerticalAlignment="Bottom">
                <TextBlock.Effect><DropShadowEffect/></TextBlock.Effect>
              </TextBlock>
              <TextBox x:Name="TribeBox" Width="320" Padding="6"
                       ScrollViewer.CanContentScroll="True" Height="28" Margin="9,0,9,0"
                       TextChanged="TribeBox_TextChanged" Background="Black"
                       VerticalContentAlignment="Center" VerticalAlignment="Bottom">
                <TextBox.Effect><DropShadowEffect/></TextBox.Effect>
              </TextBox>

              <Button x:Name="StartBtn" Content="Start" Click="StartBtn_Click"
                      Margin="60,0,4,0" Width="55" Height="22">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="StopBtn" Content="Stop" Click="StopBtn_Click"
                      Margin="4,0,60,0" Width="55" Height="22" FontFamily="Microsoft YaHei UI">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="SelectCropBtn" Content="Select Log Area..." Click="SelectCropBtn_Click"
                      Width="164" Height="22" Margin="8,0,4,0">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>

              <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Click="OcrCropBtn_Click"
                      Width="164" Height="22" Margin="4,0,4,0" BorderThickness="1">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click"
                      Padding="9,0,9,0" Margin="4,0,8,0" Height="22" Width="164" BorderThickness="1">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>

              <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Click="SaveDebugBtn_Click"
                      Width="216" Height="22" Margin="10,4,10,4">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
            </WrapPanel>
          </Border>

          <!-- Content -->
          <Grid Grid.Row="2" Margin="8,9,8,7">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Live Preview with overlay collapsed by default -->
            <GroupBox Header="Live Preview" Margin="0,0,23,17" BorderThickness="0"
                      FontFamily="Microsoft YaHei UI" BorderBrush="Black"
                      Foreground="#FFD0D0D0" FontWeight="Bold" Background="#FF16191F"
                      HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>
              <Grid Background="Black">
                <Image x:Name="LivePreview" Stretch="Uniform" ClipToBounds="True" Margin="8,8,9,10"/>
                <Border x:Name="OcrDetailsOverlay" Background="Black" Visibility="Collapsed" Margin="2" CornerRadius="2">
                  <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBlock x:Name="OcrDetailsText" FontFamily="Microsoft YaHei Light" FontSize="12" Foreground="#FF2B2F36"/>
                  </ScrollViewer>
                </Border>
              </Grid>
            </GroupBox>

            <!-- Right: three independent rows -->
            <Grid Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Center">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- API Echo -->
                <RowDefinition Height="Auto"/>  <!-- Tribe Log output -->
                <RowDefinition Height="Auto"/>  <!-- Send button -->
              </Grid.RowDefinitions>

              <GroupBox x:Name="API_Echo_Box" Grid.Row="0" Header="API Echo"
                        BorderThickness="0" Foreground="#FFD0D0D0" BorderBrush="Black"
                        FontWeight="Bold" Background="#FF16191F"
                        Padding="0" Width="400" Height="140">
                <TextBox x:Name="ApiEchoText" Width="380" Height="120"
                         FontFamily="Microsoft YaHei UI" FontSize="12"
                         AcceptsReturn="True" IsReadOnly="True"
                         TextChanged="ApiEchoText_TextChanged" BorderThickness="0.5" Padding="0" VerticalAlignment="Top"/>
              </GroupBox>

              <GroupBox x:Name="Tribe_Log_Output_Box" Grid.Row="1" Header="Tribe Log Text Output"
                        BorderThickness="0" Foreground="White" FontWeight="Bold"
                        Background="#FF16191F" Padding="0" Width="400">
                <Grid>
                  <TextBox x:Name="LogLineBox" FontFamily="Microsoft YaHei UI" FontSize="12"
                           AcceptsReturn="True" MinHeight="120" Background="Black"
                           Height="120" BorderThickness="0" Padding="6"/>
                </Grid>
              </GroupBox>

              <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center">
                <Button x:Name="SendPastedBtn"
                        Content="Send Pasted Logs"
                        Click="SendParsedBtn_Click"
                        Height="32" Width="160">
                  <Button.Effect><DropShadowEffect/></Button.Effect>
                </Button>
              </StackPanel>
            </Grid>
          </Grid>
        </Grid>
      </TabItem>

      <!-- ======================= Settings ======================= -->
      <TabItem Header="Settings"
               FontFamily="Microsoft YaHei UI"
               Background="#FF2B2F36"
               FontWeight="Bold"
               Padding="0"
               SnapsToDevicePixels="True">
        <TabItem.Effect><DropShadowEffect/></TabItem.Effect>

        <!-- Independent root; no shared rows with Capture -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Width="800" Height="750" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Margin="8" Orientation="Vertical">

            <GroupBox Header="API credentials" BorderThickness="0.5">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Channel ID" Grid.Row="0" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <TextBox x:Name="ChannelBox" Grid.Row="0" Grid.Column="1"/>

                <TextBlock Text="API Base URL" Grid.Row="1" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1"/>

                <TextBlock Text="API Key" Grid.Row="2" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <PasswordBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1"/>
              </Grid>
            </GroupBox>

            <GroupBox Header="Endpoint paths" BorderThickness="0.5">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="OCR path:" Grid.Row="0" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="OcrPathBox" Grid.Row="0" Grid.Column="1"/>

                <TextBlock Text="Screenshot ingest path:" Grid.Row="1" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="ScreenshotPathBox" Grid.Row="1" Grid.Column="1"/>

                <TextBlock Text="Log-line ingest path:" Grid.Row="2" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="LogLinePathBox" Grid.Row="2" Grid.Column="1"/>
              </Grid>
            </GroupBox>

            <GroupBox Header="Filters" BorderThickness="0.5">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>
              <UniformGrid Columns="2">
                <CheckBox x:Name="FilterTameDeathsBox"            Content="Tame deaths"/>
                <CheckBox x:Name="FilterTamesStarvingBox"          Content="Tames starving to death"/>
                <CheckBox x:Name="FilterStructDestroyedBox"        Content="Structures destroyed"/>
                <CheckBox x:Name="FilterStructAutoDecayBox"        Content="Structures auto decay"/>
                <CheckBox x:Name="FilterTribeMateDeathsBox"        Content="Tribemate deaths"/>
                <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"   Content="Tribe kills enemy tames"/>
                <CheckBox x:Name="FilterEnemyPlayerKillsBox"       Content="Enemy player kills"/>
                <CheckBox x:Name="FilterTribeDemolishBox"          Content="Tribemates demolishing structures"/>
                <CheckBox x:Name="FilterTribeFreezeTamesBox"       Content="Tribemates freezing tames"/>
              </UniformGrid>
            </GroupBox>

            <GroupBox Header="Overlay" BorderThickness="0.5">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>
              <StackPanel Orientation="Horizontal">
                <CheckBox x:Name="ShowOcrDetailsCheck"
                          Content="Show OCR details overlay on Capture"
                          Checked="ShowOcrDetailsCheck_Changed"
                          Unchecked="ShowOcrDetailsCheck_Changed"/>
              </StackPanel>
            </GroupBox>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
              <Button x:Name="SaveBtn" Content="Save" Click="SaveBtn_Click" BorderThickness="0">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
            </StackPanel>
          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>

    <!-- Status Bar -->
    <Border BorderBrush="#FF2B2F36" CornerRadius="2,2,0,0" Margin="0,878,0,0">
      <Border.Background>
        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0" Opacity="0.2">
          <GradientStop Color="#FF16191F" Offset="0.9"/>
          <GradientStop Color="#FF7B7E82" Offset="0.2"/>
        </LinearGradientBrush>
      </Border.Background>
      <Border.Effect><DropShadowEffect/></Border.Effect>
      <TextBlock x:Name="StatusText" FontFamily="Microsoft YaHei" Text="" ClipToBounds="True"/>
    </Border>
  </Grid>
</Window>
