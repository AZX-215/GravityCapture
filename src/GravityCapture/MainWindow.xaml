<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture"
        MinWidth="1120" MinHeight="680"
        WindowStartupLocation="CenterScreen">
  <DockPanel>

    <!-- Tabs -->
    <TabControl>
      <!-- Capture tab -->
      <TabItem Header="Capture">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- Top controls -->
          <Border Style="{StaticResource Card}" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="80"/>
                <ColumnDefinition Width="240"/>
                <ColumnDefinition Width="70"/>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <TextBlock Text="Server" VerticalAlignment="Center"/>
              <TextBox x:Name="ServerBox" Grid.Column="1" Margin="8,0,0,0"/>

              <TextBlock Text="Tribe" Grid.Column="2" VerticalAlignment="Center" Margin="12,0,0,0"/>
              <TextBox x:Name="TribeBox" Grid.Column="3" Margin="8,0,0,0"/>

              <Button x:Name="StartBtn" Content="Start" Grid.Column="4" Style="{StaticResource RoundButton}" Click="StartBtn_Click"/>
              <Button x:Name="StopBtn"  Content="Stop"  Grid.Column="5" Style="{StaticResource RoundButton}" Margin="6,0,0,0" Click="StopBtn_Click"/>
              <Button x:Name="SelectAreaBtn" Content="Select Log Area..." Grid.Column="6" Style="{StaticResource RoundButton}" Click="SelectAreaBtn_Click"/>
            </Grid>
          </Border>

          <!-- OCR action buttons beside preview -->
          <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,12,0,6">
            <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Style="{StaticResource RoundButton}" Click="OcrCropBtn_Click"/>
            <Button x:Name="OcrPostVisibleBtn" Content="OCR &amp; Post Visible Now" Style="{StaticResource RoundButton}" Click="OcrPostVisibleBtn_Click"/>
            <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Style="{StaticResource RoundButton}" Click="SaveDebugBtn_Click"/>
          </StackPanel>

          <!-- Live preview and overlay -->
          <Border Style="{StaticResource Card}" Grid.Row="2" Grid.Column="0">
            <Grid>
              <Image x:Name="LivePreview" Stretch="Uniform" />
              <!-- non-hit overlay for OCR boxes when shown -->
              <Canvas x:Name="OcrDetailsOverlay" IsHitTestVisible="False"/>
            </Grid>
          </Border>

          <!-- API echo on right -->
          <Border Style="{StaticResource Card}" Grid.Row="2" Grid.Column="2">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
              </Grid.RowDefinitions>

              <TextBlock Text="API echo" Margin="0,0,0,6"/>
              <TextBox x:Name="ApiEchoText"
                       Grid.Row="1"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       HorizontalScrollBarVisibility="Auto"
                       TextWrapping="NoWrap"/>
            </Grid>
          </Border>

          <!-- Paste-a-line and send -->
          <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="190"/>
            </Grid.ColumnDefinitions>

            <Border Style="{StaticResource Card}" Grid.Column="0">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Text="Paste a tribe log line:" Margin="0,0,0,6"/>
                <TextBox x:Name="PastedLogLineBox"
                         Grid.Row="1"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"/>
              </Grid>
            </Border>

            <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Right">
              <Button x:Name="SendPastedBtn"
                      Content="Send Pasted Log Line"
                      Style="{StaticResource RoundButton}"
                      Width="180"
                      HorizontalAlignment="Right"
                      Click="SendPastedBtn_Click"/>
              <!-- optional file path display your code-behind may fill -->
              <TextBox x:Name="LogLinePathBox" Margin="0,10,0,0" IsReadOnly="True" />
            </StackPanel>
          </Grid>

          <!-- Status -->
          <TextBlock x:Name="StatusText"
                     Grid.Row="3" Grid.Column="0"
                     Margin="0,56,0,0"
                     Foreground="{StaticResource TextMutedBrush}"/>
        </Grid>
      </TabItem>

      <!-- Settings tab -->
      <TabItem Header="Settings">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="10" Orientation="Vertical" >

            <!-- API credentials -->
            <Border Style="{StaticResource Card}">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Channel ID:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="ChannelIdBox" Grid.Row="0" Grid.Column="1" Margin="8,0,0,8"/>

                <TextBlock Text="API Base URL:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1" Margin="8,0,0,8"/>

                <TextBlock Text="API Key:" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1" Margin="8,0,0,8"/>

                <TextBlock Text="OCR path:" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="OcrPathBox" Grid.Row="3" Grid.Column="1" Margin="8,0,0,0"
                         ToolTip="Relative API path, e.g. /ocr (your current stage: /extract)"/>
              </Grid>
            </Border>

            <!-- Endpoints (screenshot + log-line) -->
            <Border Style="{StaticResource Card}" Margin="0,10,0,0">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Screenshot ingest:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="ScreenshotIngestPathBox" Grid.Row="0" Grid.Column="1" Margin="8,0,0,8" Text="/ingest/screenshot"/>

                <TextBlock Text="Log-line ingest:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBox x:Name="LogIngestPathBox" Grid.Row="1" Grid.Column="1" Margin="8,0,0,0" Text="/ingest/log-line"/>
              </Grid>
            </Border>

            <!-- Filters -->
            <Border Style="{StaticResource Card}" Margin="0,10,0,0">
              <StackPanel>
                <TextBlock Text="Filters" FontWeight="SemiBold" Margin="0,0,0,6"/>
                <WrapPanel>
                  <StackPanel Width="280">
                    <CheckBox x:Name="FilterTameDeathsBox"           Content="Tame deaths"/>
                    <CheckBox x:Name="FilterTamesStarvingBox"         Content="Tames starving to death"/>
                    <CheckBox x:Name="FilterStructDestroyedBox"       Content="Structures destroyed"/>
                    <CheckBox x:Name="FilterStructAutoDecayBox"       Content="Structures auto decay"/>
                    <CheckBox x:Name="FilterTribemateDeathsBox"       Content="Tribemate deaths"/>
                  </StackPanel>
                  <StackPanel Width="320" Margin="24,0,0,0">
                    <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"  Content="Tribe kills enemy tames"/>
                    <CheckBox x:Name="FilterEnemyPlayerKillsBox"      Content="Enemy player kills"/>
                    <CheckBox x:Name="FilterTribeDemolishBox"         Content="Tribemates demolishing structures"/>
                    <CheckBox x:Name="FilterTribeFreezeTamesBox"      Content="Tribemates freezing tames"/>
                  </StackPanel>
                </WrapPanel>
              </StackPanel>
            </Border>

            <!-- Misc settings -->
            <Border Style="{StaticResource Card}" Margin="0,10,0,0">
              <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <CheckBox x:Name="ShowOcrDetailsCheck"
                          Content="Show OCR details"
                          Margin="0,0,20,0"
                          Checked="ShowOcrDetailsCheck_Changed"
                          Unchecked="ShowOcrDetailsCheck_Changed"/>
                <Button x:Name="SaveSettingsBtn"
                        Content="Save"
                        Width="120"
                        Style="{StaticResource RoundButton}"
                        Click="SaveBtn_Click"/>
              </StackPanel>
            </Border>

          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </DockPanel>
</Window>
