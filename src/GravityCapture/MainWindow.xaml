<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture" Height="580" Width="980"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="12">
        <!-- Background image as embedded Resource -->
        <Grid.Background>
            <ImageBrush ImageSource="pack://application:,,,/Assets/Gravity_Logs_Background.png"
                        Stretch="UniformToFill" Opacity="0.18"/>
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Row 0: Settings -->
        <StackPanel Orientation="Vertical" Grid.Row="0" Margin="0,0,0,12">
            <!-- API URL + Key -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="API URL:" VerticalAlignment="Center" Width="80"/>
                <TextBox x:Name="ApiUrlBox" MinWidth="400" Margin="6,0,24,0"/>
                <TextBlock Text="API Key:" VerticalAlignment="Center" Width="80"/>
                <TextBox x:Name="ApiKeyBox" MinWidth="320" Margin="6,0,0,0"/>
            </StackPanel>

            <!-- Server + Tribe -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="Server:" VerticalAlignment="Center" Width="80"/>
                <TextBox x:Name="ServerBox" MinWidth="320" Margin="6,0,24,0" />
                <TextBlock Text="Tribe:" VerticalAlignment="Center" Width="80"/>
                <TextBox x:Name="TribeBox" MinWidth="220" Margin="6,0,0,0" />
            </StackPanel>

            <!-- Window title hint -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="Window title contains:" VerticalAlignment="Center" Width="160"/>
                <TextBox x:Name="TitleHintBox" MinWidth="360" Margin="6,0,0,0"
                         ToolTip="If set, GravityCapture targets the visible window whose title contains this text. Otherwise it uses the window under your selection or the foreground window."/>
            </StackPanel>

            <!-- Channel + Interval + Active Window -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="Channel ID:" VerticalAlignment="Center" Width="80"/>
                <TextBox x:Name="ChannelBox" MinWidth="160" Margin="6,0,24,0"/>
                <TextBlock Text="Interval (min):" VerticalAlignment="Center" Width="110"/>
                <TextBox x:Name="IntervalBox" MinWidth="80" Margin="6,0,24,0"/>
                <CheckBox x:Name="ActiveWindowCheck" Content="Capture Active Window Only" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Quality -->
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="JPEG Quality:" VerticalAlignment="Center" Width="110"/>
                <Slider x:Name="QualitySlider" Width="260" Minimum="10" Maximum="100" SmallChange="1" LargeChange="5" Margin="6,0,12,0"/>
                <TextBlock x:Name="QualityLabel" Width="40" VerticalAlignment="Center" TextAlignment="Center"/>
            </StackPanel>
        </StackPanel>

        <!-- Row 1: Actions -->
        <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,12">
            <Button x:Name="SaveBtn"  Content="Save"  Width="110" Margin="0,0,8,0" Click="SaveBtn_Click"/>
            <Button x:Name="StartBtn" Content="Start" Width="110" Margin="0,0,8,0" Click="StartBtn_Click"/>
            <Button x:Name="StopBtn"  Content="Stop"  Width="110" Margin="0,0,12,0" Click="StopBtn_Click"/>

            <Button x:Name="SendTestBtn"
                    Content="Send Test Tribe Event (Stage)"
                    Width="230" Margin="0,0,12,0"
                    Click="SendTestBtn_Click"/>

            <Button x:Name="SendParsedBtn"
                    Content="Send Pasted Log Line (Stage)"
                    Width="250"
                    Click="SendParsedBtn_Click"/>

            <Button x:Name="RefreshRecentBtn"
                    Content="Refresh Recent"
                    Width="160" Margin="12,0,0,0"
                    Click="RefreshRecentBtn_Click"/>

            <Button x:Name="SelectCropBtn"
                    Content="Select Log Area…"
                    Width="160" Margin="12,0,0,0"
                    Click="SelectCropBtn_Click"/>

            <Button x:Name="PreviewCropBtn"
                    Content="Preview Crop"
                    Width="140" Margin="8,0,0,0"
                    Click="PreviewCropBtn_Click"/>

            <!-- NEW: OCR test button -->
            <Button x:Name="OcrCropBtn"
                    Content="OCR Crop → Paste"
                    Width="160" Margin="8,0,0,0"
                    Click="OcrCropBtn_Click"/>
        </StackPanel>

        <!-- Row 2: Paste + Recent grid -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" BorderBrush="#22000000" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,0,0,8">
                <DockPanel LastChildFill="True">
                    <TextBlock Text="Paste a tribe log line:" DockPanel.Dock="Top" Margin="0,0,0,6"/>
                    <TextBox x:Name="LogLineBox"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             FontFamily="Consolas"
                             Height="140"/>
                </DockPanel>
            </Border>

            <DataGrid x:Name="RecentGrid"
                      Grid.Row="1"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      FontSize="12">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="60"/>
                    <DataGridTextColumn Header="When (UTC)" Binding="{Binding ingested_at}" Width="170"/>
                    <DataGridTextColumn Header="Severity" Binding="{Binding severity}" Width="90"/>
                    <DataGridTextColumn Header="Category" Binding="{Binding category}" Width="150"/>
                    <DataGridTextColumn Header="Actor" Binding="{Binding actor}" Width="220"/>
                    <DataGridTextColumn Header="Message" Binding="{Binding message}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- Row 3: Status bar -->
        <DockPanel Grid.Row="3" LastChildFill="True" Margin="0,12,0,0">
            <TextBlock Text="Status:" Margin="0,0,6,0" VerticalAlignment="Center"/>
            <TextBlock x:Name="StatusText" VerticalAlignment="Center"/>
        </DockPanel>
    </Grid>
</Window>
