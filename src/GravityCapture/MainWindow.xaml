<Window
    x:Class="GravityCapture.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="av"
    Title="Gravity Capture"
    Icon="Assets/GravityCapture_Rounded.ico"
    MinWidth="820" MinHeight="920"
    MaxWidth="820" MaxHeight="920"
    Background="{x:Null}"
    Loaded="Window_Loaded"
    Closing="Window_Closing"
    SourceInitialized="Window_SourceInitialized"
    SizeChanged="Window_SizeChanged"
    HorizontalContentAlignment="Stretch"
    VerticalContentAlignment="Stretch">

    <Grid Background="#FF16191F">
        <Grid.RowDefinitions>
            <!-- 0: tabs -->
            <RowDefinition Height="70"/>
            <!-- 1: banner -->
            <RowDefinition Height="115"/>
            <!-- 2: capture toolbar -->
            <RowDefinition Height="90"/>
            <!-- 3: page body (capture/settings) -->
            <RowDefinition Height="*"/>
            <!-- 4: status -->
            <RowDefinition Height="26"/>
        </Grid.RowDefinitions>

        <!-- tabs row -->
        <Border Grid.Row="0" Background="#252931">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,4,0,0">
                <Button x:Name="CaptureTabButton"
                        Width="180"
                        Height="42"
                        Margin="0,0,18,0"
                        Background="#3A3F47"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="SemiBold"
                        BorderThickness="0"
                        Click="CaptureTabButton_Click"
                        Cursor="Hand"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center">
                    Capture
                </Button>

                <Button x:Name="SettingsTabButton"
                        Width="180"
                        Height="42"
                        Margin="0"
                        Background="#2E333A"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="SemiBold"
                        BorderThickness="0"
                        Click="SettingsTabButton_Click"
                        Cursor="Hand"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center">
                    Settings
                </Button>
            </StackPanel>
        </Border>

        <!-- banner row -->
        <Border Grid.Row="1" Background="#1F232A" BorderBrush="#1F232A" BorderThickness="0,0,0,3">
            <Image Source="Assets/Gravity_Capture_App_Banner.png"
                   Width="280"
                   Height="90"
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
        </Border>

        <!-- capture toolbar row -->
        <Border Grid.Row="2" Background="#FF16191F" Padding="8,4,8,4">
            <StackPanel Orientation="Vertical">
                <!-- row 1 -->
                <Grid Margin="0,2,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Server" Foreground="#FFD60000" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,6,0"/>
                    <TextBox x:Name="ServerBox"
                             Grid.Column="1"
                             Height="26"
                             Background="Black"
                             Foreground="White"
                             BorderBrush="#3A3F47"
                             TextChanged="ServerBox_TextChanged"
                             VerticalContentAlignment="Center"
                             Margin="0,0,16,0"/>

                    <TextBlock Grid.Column="2" Text="Tribe" Foreground="#FFD60000" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,6,0"/>
                    <TextBox x:Name="TribeBox"
                             Grid.Column="3"
                             Height="26"
                             Background="Black"
                             Foreground="White"
                             BorderBrush="#3A3F47"
                             TextChanged="TribeBox_TextChanged"
                             VerticalContentAlignment="Center"/>
                </Grid>

                <!-- row 2: buttons -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,0">
                    <Button x:Name="StartBtn" Content="Start" Width="60" Height="26" Margin="0,0,6,0" Click="StartBtn_Click"/>
                    <Button x:Name="StopBtn" Content="Stop" Width="60" Height="26" Margin="0,0,14,0" Click="StopBtn_Click"/>

                    <Button x:Name="SelectCropBtn" Content="Select Log Area..." Width="140" Height="26" Margin="0,0,6,0" Click="SelectCropBtn_Click"/>
                    <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Width="140" Height="26" Margin="0,0,6,0" Click="OcrCropBtn_Click"/>
                    <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Width="170" Height="26" Margin="0,0,0,0" Click="OcrAndPostNowBtn_Click"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- capture page -->
        <Grid x:Name="CapturePage" Grid.Row="3" Margin="8,4,8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3.3*"/>
                <ColumnDefinition Width="2.2*"/>
            </Grid.ColumnDefinitions>

            <!-- left: live preview -->
            <GroupBox Header="Live Preview"
                      Margin="0,0,10,0"
                      BorderThickness="1"
                      BorderBrush="#2E333A"
                      Foreground="White"
                      FontWeight="SemiBold"
                      Background="#1B1E24">
                <Grid Background="#000000" Margin="6">
                    <Image x:Name="LivePreview"
                           Stretch="Uniform"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           SnapsToDevicePixels="True"/>

                    <!-- OCR overlay (stays transparent if disabled) -->
                    <Border x:Name="OcrDetailsOverlay"
                            Background="#00000000"
                            Visibility="Collapsed"
                            Margin="4"
                            CornerRadius="4">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBlock x:Name="OcrDetailsText"
                                       FontSize="12"
                                       Foreground="White"
                                       TextWrapping="Wrap"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </GroupBox>

            <!-- right side -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- API Echo -->
                <GroupBox x:Name="API_Echo_Box"
                          Grid.Row="0"
                          Header="API Echo"
                          Margin="0,0,0,8"
                          BorderThickness="1"
                          BorderBrush="#2E333A"
                          Background="#1B1E24"
                          Foreground="White"
                          FontWeight="SemiBold">
                    <TextBox x:Name="ApiEchoText"
                             Margin="6"
                             Background="Black"
                             Foreground="White"
                             BorderThickness="0.5"
                             TextChanged="ApiEchoText_TextChanged"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"/>
                </GroupBox>

                <!-- Tribe Log Output -->
                <GroupBox x:Name="Tribe_Log_Output_Box"
                          Grid.Row="1"
                          Header="Tribe Log Text Output Testing"
                          Margin="0,0,0,8"
                          BorderThickness="1"
                          BorderBrush="#2E333A"
                          Background="#1B1E24"
                          Foreground="White"
                          FontWeight="SemiBold">
                    <TextBox x:Name="LogLineBox"
                             Margin="6"
                             Background="Black"
                             Foreground="White"
                             BorderThickness="0"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             Height="140"/>
                </GroupBox>

                <!-- send button -->
                <Button x:Name="SendPastedBtn"
                        Grid.Row="2"
                        Content="Send Pasted Logs"
                        Width="180"
                        Height="28"
                        HorizontalAlignment="Right"
                        Margin="0,0,0,2"
                        Click="SendPastedBtn_Click"/>
            </Grid>
        </Grid>

        <!-- settings page -->
        <Grid x:Name="SettingsPage" Grid.Row="3" Visibility="Collapsed" Margin="8,4,8,4">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical" Margin="0,0,0,4" >

                    <!-- API credentials -->
                    <GroupBox Header="API credentials"
                              BorderThickness="0.5"
                              Foreground="White"
                              Background="#1B1E24"
                              Margin="0,0,0,6">
                        <Grid Margin="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Channel ID" Grid.Row="0" Grid.Column="0" Foreground="White" VerticalAlignment="Center"/>
                            <TextBox x:Name="ChannelBox" Grid.Row="0" Grid.Column="1" Background="Black" Foreground="White"/>

                            <TextBlock Text="API Base URL" Grid.Row="1" Grid.Column="0" Foreground="White" VerticalAlignment="Center" Margin="0,4,0,0"/>
                            <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1" Background="Black" Foreground="White" Margin="0,4,0,0"/>

                            <TextBlock Text="API Key" Grid.Row="2" Grid.Column="0" Foreground="White" VerticalAlignment="Center" Margin="0,4,0,0"/>
                            <PasswordBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1" Background="Black" Foreground="White" Margin="0,4,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- endpoints -->
                    <GroupBox Header="Endpoint paths"
                              BorderThickness="0.5"
                              Foreground="White"
                              Background="#1B1E24"
                              Margin="0,0,0,6">
                        <Grid Margin="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="OCR path:" Grid.Row="0" Grid.Column="0" Foreground="White" VerticalAlignment="Center"/>
                            <TextBox x:Name="OcrPathBox" Grid.Row="0" Grid.Column="1" Background="Black" Foreground="White"/>

                            <TextBlock Text="Screenshot ingest path:" Grid.Row="1" Grid.Column="0" Foreground="White" VerticalAlignment="Center" Margin="0,4,0,0"/>
                            <TextBox x:Name="ScreenshotPathBox" Grid.Row="1" Grid.Column="1" Background="Black" Foreground="White" Margin="0,4,0,0"/>

                            <TextBlock Text="Log-line ingest path:" Grid.Row="2" Grid.Column="0" Foreground="White" VerticalAlignment="Center" Margin="0,4,0,0"/>
                            <TextBox x:Name="LogLinePathBox" Grid.Row="2" Grid.Column="1" Background="Black" Foreground="White" Margin="0,4,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- filters -->
                    <GroupBox Header="Filters"
                              BorderThickness="0.5"
                              Foreground="White"
                              Background="#1B1E24"
                              Margin="0,0,0,6">
                        <GroupBox.Resources>
                            <Style TargetType="CheckBox">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                        </GroupBox.Resources>
                        <UniformGrid Columns="2" Margin="4">
                            <CheckBox x:Name="FilterTameDeathsBox"            Content="Tame deaths"/>
                            <CheckBox x:Name="FilterTamesStarvingBox"          Content="Tames starving to death"/>
                            <CheckBox x:Name="FilterStructDestroyedBox"        Content="Structures destroyed"/>
                            <CheckBox x:Name="FilterStructAutoDecayBox"        Content="Structures auto decay"/>
                            <CheckBox x:Name="FilterTribeMateDeathsBox"        Content="Tribemate deaths"/>
                            <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"   Content="Tribe kills enemy tames"/>
                            <CheckBox x:Name="FilterEnemyPlayerKillsBox"       Content="Enemy player kills"/>
                            <CheckBox x:Name="FilterTribeDemolishBox"          Content="Tribemates demolishing structures"/>
                            <CheckBox x:Name="FilterTribeFreezeTamesBox"       Content="Tribemates freezing tames"/>
                        </UniformGrid>
                    </GroupBox>

                    <!-- overlay -->
                    <GroupBox Header="Overlay"
                              BorderThickness="0.5"
                              Foreground="White"
                              Background="#1B1E24"
                              Margin="0,0,0,6">
                        <StackPanel Orientation="Horizontal" Margin="4">
                            <CheckBox x:Name="ShowOcrDetailsCheck"
                                      Content="Show OCR details overlay on Capture"
                                      Checked="ShowOcrDetailsCheck_Changed"
                                      Unchecked="ShowOcrDetailsCheck_Changed"
                                      Foreground="White"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- actions -->
                    <StackPanel Orientation="Horizontal" Margin="0,2,0,4">
                        <Button x:Name="SaveBtn"
                                Content="Save"
                                Width="90"
                                Height="28"
                                Margin="0,0,8,0"
                                Click="SaveBtn_Click"/>
                        <Button x:Name="SaveDebugBtn"
                                Content="Save debug ZIP"
                                Width="140"
                                Height="28"
                                Click="SaveDebugBtn_Click"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- status bar -->
        <Border Grid.Row="4" BorderBrush="#FF2B2F36" Background="#FF16191F" Padding="4,0,4,0">
            <TextBlock x:Name="StatusText"
                       VerticalAlignment="Center"
                       Foreground="White"
                       FontSize="11"
                       Text=""/>
        </Border>
    </Grid>
</Window>
