<Window
    x:Class="GravityCapture.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="av"
    Title="Gravity Capture"
    MinWidth="820" MinHeight="920"
    MaxWidth="820" MaxHeight="920"
    Background="{x:Null}"
    Loaded="Window_Loaded"
    Closing="Window_Closing"
    SourceInitialized="Window_SourceInitialized"
    SizeChanged="Window_SizeChanged"
    HorizontalContentAlignment="Stretch"
    VerticalContentAlignment="Stretch">

    <Grid Background="#FF16191F">
        <Grid.RowDefinitions>
            <!-- tabs -->
            <RowDefinition Height="Auto"/>
            <!-- banner -->
            <RowDefinition Height="Auto"/>
            <!-- capture toolbar -->
            <RowDefinition Height="Auto"/>
            <!-- page content -->
            <RowDefinition Height="*"/>
            <!-- status bar -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 1. TABS -->
        <TabControl x:Name="TopTabs"
                    Grid.Row="0"
                    SelectionChanged="TabControl_SelectionChanged"
                    Background="Transparent"
                    BorderThickness="0"
                    Margin="0,8,0,6"
                    HorizontalAlignment="Center"
                    Width="520"
                    Height="50">
            <TabItem Header="Capture"
                     FontWeight="Bold"
                     Background="#FF2B2F36" />
            <TabItem Header="Settings"
                     FontWeight="Bold"
                     Background="#FF2B2F36" />
        </TabControl>

        <!-- 2. BANNER -->
        <Border Grid.Row="1"
                Background="#FF101014"
                Height="82"
                Margin="0,0,0,6">
            <Image Source="/GravityCapture;component/Images/Gravity_Capture_App_Banner.png"
                   Height="70"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
        </Border>

        <!-- 3. TOOLBAR (capture controls) -->
        <Border Grid.Row="2"
                Width="820"
                HorizontalAlignment="Center"
                Background="Transparent"
                Margin="0,0,0,6">
            <WrapPanel ItemHeight="32"
                       VerticalAlignment="Top"
                       Height="96"
                       Margin="0,0,0,0">
                <TextBlock Text="Server"
                           Margin="9,0,9,0"
                           Foreground="Red"
                           FontFamily="Microsoft YaHei UI"
                           FontSize="14"
                           VerticalAlignment="Bottom">
                    <TextBlock.Effect>
                        <DropShadowEffect/>
                    </TextBlock.Effect>
                </TextBlock>

                <TextBox x:Name="ServerBox"
                         Width="320"
                         Margin="9,0,9,0"
                         Height="28"
                         Background="Black"
                         VerticalContentAlignment="Center"
                         VerticalAlignment="Bottom"
                         TextChanged="ServerBox_TextChanged">
                    <TextBox.Effect>
                        <DropShadowEffect/>
                    </TextBox.Effect>
                </TextBox>

                <TextBlock Text="Tribe"
                           Margin="9,0,9,0"
                           Foreground="Red"
                           FontFamily="Microsoft YaHei UI"
                           FontSize="14"
                           VerticalAlignment="Bottom">
                    <TextBlock.Effect>
                        <DropShadowEffect/>
                    </TextBlock.Effect>
                </TextBlock>

                <TextBox x:Name="TribeBox"
                         Width="320"
                         Margin="9,0,9,0"
                         Height="28"
                         Background="Black"
                         VerticalContentAlignment="Center"
                         VerticalAlignment="Bottom"
                         TextChanged="TribeBox_TextChanged">
                    <TextBox.Effect>
                        <DropShadowEffect/>
                    </TextBox.Effect>
                </TextBox>

                <Button x:Name="StartBtn"
                        Content="Start"
                        Click="StartBtn_Click"
                        Margin="60,0,4,0"
                        Width="55"
                        Height="22"
                        VerticalAlignment="Bottom">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <Button x:Name="StopBtn"
                        Content="Stop"
                        Click="StopBtn_Click"
                        Margin="4,0,60,0"
                        Width="55"
                        Height="22"
                        VerticalAlignment="Bottom">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <Button x:Name="SelectCropBtn"
                        Content="Select Log Area..."
                        Click="SelectCropBtn_Click"
                        Width="164"
                        Height="22"
                        Margin="8,0,4,0"
                        VerticalAlignment="Bottom">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <Button x:Name="OcrCropBtn"
                        Content="OCR Crop â†’ Paste"
                        Click="OcrCropBtn_Click"
                        Width="164"
                        Height="22"
                        Margin="4,0,4,0"
                        VerticalAlignment="Bottom">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <Button x:Name="OcrAndPostNowBtn"
                        Content="OCR &amp; Post Visible Now"
                        Click="OcrAndPostNowBtn_Click"
                        Width="164"
                        Height="22"
                        Margin="4,0,8,0"
                        VerticalAlignment="Bottom">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <!-- NOTE: Save debug ZIP moved to Settings tab -->
            </WrapPanel>
        </Border>

        <!-- 4A. CAPTURE PAGE -->
        <Grid x:Name="CapturePage"
              Grid.Row="3"
              Margin="8,0,8,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.25*"/>
                <ColumnDefinition Width="0.75*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Live Preview -->
            <GroupBox Header="Live Preview"
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      BorderThickness="0"
                      FontFamily="Microsoft YaHei UI"
                      Foreground="#FFD0D0D0"
                      FontWeight="Bold"
                      Background="#FF16191F">
                <GroupBox.Effect>
                    <DropShadowEffect/>
                </GroupBox.Effect>

                <Border Background="Black"
                        Margin="4"
                        CornerRadius="3"
                        BorderBrush="#442B2F36"
                        BorderThickness="1">
                    <Grid>
                        <!-- SCALE TO FIT -->
                        <Viewbox Stretch="Uniform"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Stretch">
                            <Image x:Name="LivePreview"
                                   Stretch="Uniform"
                                   ClipToBounds="True"
                                   Margin="4"/>
                        </Viewbox>

                        <!-- OCR overlay (can be shown/hidden) -->
                        <Border x:Name="OcrDetailsOverlay"
                                Background="Black"
                                Opacity="0.85"
                                CornerRadius="2"
                                Margin="4"
                                Visibility="Collapsed">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBlock x:Name="OcrDetailsText"
                                           FontFamily="Microsoft YaHei Light"
                                           FontSize="12"
                                           Foreground="#FF2B2F36"
                                           TextWrapping="Wrap"/>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Border>
            </GroupBox>

            <!-- RIGHT: API Echo + Tribe Log + Button -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- API ECHO -->
                <GroupBox x:Name="API_Echo_Box"
                          Grid.Row="0"
                          Header="API Echo"
                          FontFamily="Microsoft YaHei UI"
                          BorderThickness="0"
                          Foreground="#FFD0D0D0"
                          FontWeight="Bold"
                          Background="#FF16191F"
                          Margin="0,0,0,6">
                    <TextBox x:Name="ApiEchoText"
                             Margin="6"
                             FontFamily="Microsoft YaHei UI"
                             FontSize="12"
                             AcceptsReturn="True"
                             IsReadOnly="True"
                             TextChanged="ApiEchoText_TextChanged"
                             BorderThickness="0.5"
                             VerticalAlignment="Stretch"
                             HorizontalAlignment="Stretch"/>
                </GroupBox>

                <!-- TRIBE LOG BOX -->
                <GroupBox x:Name="Tribe_Log_Output_Box"
                          Grid.Row="1"
                          Header="Tribe Log Text Output Testing"
                          FontFamily="Microsoft YaHei UI"
                          BorderThickness="0"
                          Foreground="White"
                          FontWeight="Bold"
                          Background="#FF16191F"
                          Margin="0,0,0,6">
                    <Grid>
                        <TextBox x:Name="LogLineBox"
                                 Margin="6"
                                 FontFamily="Microsoft YaHei UI"
                                 FontSize="12"
                                 AcceptsReturn="True"
                                 BorderThickness="0"
                                 Background="Black"
                                 VerticalAlignment="Stretch"
                                 TextWrapping="Wrap"/>
                    </Grid>
                </GroupBox>

                <!-- SEND BUTTON -->
                <Button x:Name="SendPastedBtn"
                        Grid.Row="2"
                        Content="Send Pasted Logs"
                        Click="SendParsedBtn_Click"
                        Width="180"
                        Height="34"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>
            </Grid>
        </Grid>

        <!-- 4B. SETTINGS PAGE -->
        <ScrollViewer x:Name="SettingsPage"
                      Grid.Row="3"
                      Visibility="Collapsed"
                      VerticalScrollBarVisibility="Auto"
                      Margin="8,0,8,8">
            <StackPanel Orientation="Vertical" Margin="0,0,0,8">

                <GroupBox Header="API credentials" BorderThickness="0.5">
                    <GroupBox.Effect>
                        <DropShadowEffect/>
                    </GroupBox.Effect>
                    <Grid Margin="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Channel ID"
                                   Grid.Row="0" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                        <TextBox x:Name="ChannelBox" Grid.Row="0" Grid.Column="1"/>

                        <TextBlock Text="API Base URL"
                                   Grid.Row="1" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                        <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1"/>

                        <TextBlock Text="API Key"
                                   Grid.Row="2" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                        <PasswordBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Endpoint paths" BorderThickness="0.5" Margin="0,8,0,0">
                    <GroupBox.Effect>
                        <DropShadowEffect/>
                    </GroupBox.Effect>
                    <Grid Margin="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="OCR path:"
                                   Grid.Row="0" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBox x:Name="OcrPathBox" Grid.Row="0" Grid.Column="1"/>

                        <TextBlock Text="Screenshot ingest path:"
                                   Grid.Row="1" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBox x:Name="ScreenshotPathBox" Grid.Row="1" Grid.Column="1"/>

                        <TextBlock Text="Log-line ingest path:"
                                   Grid.Row="2" Grid.Column="0"
                                   Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBox x:Name="LogLinePathBox" Grid.Row="2" Grid.Column="1"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Filters" BorderThickness="0.5" Margin="0,8,0,0">
                    <GroupBox.Effect>
                        <DropShadowEffect/>
                    </GroupBox.Effect>
                    <UniformGrid Columns="2">
                        <CheckBox x:Name="FilterTameDeathsBox"            Content="Tame deaths"/>
                        <CheckBox x:Name="FilterTamesStarvingBox"          Content="Tames starving to death"/>
                        <CheckBox x:Name="FilterStructDestroyedBox"        Content="Structures destroyed"/>
                        <CheckBox x:Name="FilterStructAutoDecayBox"        Content="Structures auto decay"/>
                        <CheckBox x:Name="FilterTribeMateDeathsBox"        Content="Tribemate deaths"/>
                        <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"   Content="Tribe kills enemy tames"/>
                        <CheckBox x:Name="FilterEnemyPlayerKillsBox"       Content="Enemy player kills"/>
                        <CheckBox x:Name="FilterTribeDemolishBox"          Content="Tribemates demolishing structures"/>
                        <CheckBox x:Name="FilterTribeFreezeTamesBox"       Content="Tribemates freezing tames"/>
                    </UniformGrid>
                </GroupBox>

                <GroupBox Header="Overlay" BorderThickness="0.5" Margin="0,8,0,0">
                    <GroupBox.Effect>
                        <DropShadowEffect/>
                    </GroupBox.Effect>
                    <StackPanel Orientation="Horizontal" Margin="6,2,6,6">
                        <CheckBox x:Name="ShowOcrDetailsCheck"
                                  Content="Show OCR details overlay on Capture"
                                  Checked="ShowOcrDetailsCheck_Changed"
                                  Unchecked="ShowOcrDetailsCheck_Changed"/>
                    </StackPanel>
                </GroupBox>

                <!-- Save debug ZIP moved here -->
                <Button x:Name="SaveDebugBtn"
                        Content="Save debug ZIP"
                        Click="SaveDebugBtn_Click"
                        Width="160"
                        Margin="0,10,0,0">
                    <Button.Effect>
                        <DropShadowEffect/>
                    </Button.Effect>
                </Button>

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button x:Name="SaveBtn"
                            Content="Save"
                            Click="SaveBtn_Click"
                            BorderThickness="0">
                        <Button.Effect>
                            <DropShadowEffect/>
                        </Button.Effect>
                    </Button>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- 5. STATUS BAR -->
        <Border Grid.Row="4"
                BorderBrush="#FF2B2F36"
                CornerRadius="2,2,0,0"
                Margin="0,0,0,0"
                Background="#FF1A1D23"
                Height="28">
            <TextBlock x:Name="StatusText"
                       FontFamily="Microsoft YaHei"
                       Margin="6,4,0,0"
                       Foreground="White"
                       Text=""/>
        </Border>
    </Grid>
</Window>
