<Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="av"
  x:Class="GravityCapture.MainWindow"
  Title="Gravity Capture"
  MinWidth="820" MinHeight="920"
  MaxWidth="820" MaxHeight="920"
  Background="{x:Null}"
  Loaded="Window_Loaded"
  Closing="Window_Closing"
  SourceInitialized="Window_SourceInitialized"
  SizeChanged="Window_SizeChanged"
  HorizontalContentAlignment="Stretch"
  VerticalContentAlignment="Stretch">

  <Grid Background="#FF16191F">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <TabControl SelectionChanged="TabControl_SelectionChanged"
                SelectedIndex="0"
                IsSynchronizedWithCurrentItem="True"
                Padding="0"
                BorderThickness="0"
                HorizontalAlignment="Center"
                VerticalAlignment="Stretch"
                Height="Auto"
                Width="800">

      <!-- ========== Capture ========== -->
      <TabItem Header="Capture" FontWeight="Bold" Padding="0" SnapsToDevicePixels="True">
        <TabItem.Effect><DropShadowEffect/></TabItem.Effect>

        <Grid>
          <Grid.Background>
            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
              <GradientStop Color="Black"/>
              <GradientStop Color="#FF16191F" Offset="0.412"/>
            </LinearGradientBrush>
          </Grid.Background>

          <!-- rows: Banner / Toolbar / Content fills rest -->
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Banner -->
          <Border Grid.Row="0" Width="820" VerticalAlignment="Bottom">
            <Image Height="56" Margin="12,6" Stretch="Uniform"
                   Source="Assets/Gravity_Capture_App_Banner.png"/>
          </Border>

          <!-- Toolbar -->
          <Border Grid.Row="1" Width="820" VerticalAlignment="Bottom">
            <WrapPanel ItemHeight="32" VerticalAlignment="Top" Height="104">
              <TextBlock Text="Server" Margin="9,0,9,0" Foreground="Red" FontSize="14" Height="22" VerticalAlignment="Bottom">
                <TextBlock.Effect><DropShadowEffect/></TextBlock.Effect>
              </TextBlock>
              <TextBox x:Name="ServerBox" Width="320" Margin="9,0,9,0" TextChanged="ServerBox_TextChanged" Height="28" Background="Black" VerticalContentAlignment="Center" VerticalAlignment="Bottom">
                <TextBox.Effect><DropShadowEffect/></TextBox.Effect>
              </TextBox>

              <TextBlock Text="Tribe" Margin="9,0,9,0" Foreground="Red" FontSize="14" Height="22" VerticalAlignment="Bottom">
                <TextBlock.Effect><DropShadowEffect/></TextBlock.Effect>
              </TextBlock>
              <TextBox x:Name="TribeBox" Width="320" Padding="6" ScrollViewer.CanContentScroll="True" Height="28" Margin="9,0,9,0" TextChanged="TribeBox_TextChanged" Background="Black" VerticalContentAlignment="Center" VerticalAlignment="Bottom">
                <TextBox.Effect><DropShadowEffect/></TextBox.Effect>
              </TextBox>

              <Button x:Name="StartBtn" Content="Start" Click="StartBtn_Click" Margin="60,0,4,0" Width="55" Height="22">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="StopBtn" Content="Stop" Click="StopBtn_Click" Margin="4,0,60,0" Width="55" Height="22">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="SelectCropBtn" Content="Select Log Area..." Click="SelectCropBtn_Click" Width="164" Height="22" Margin="8,0,4,0">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>

              <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Click="OcrCropBtn_Click" Width="164" Height="22" Margin="4,0,4,0" BorderThickness="1">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
              <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click" Padding="9,0,9,0" Margin="4,0,8,0" Height="22" Width="164" BorderThickness="1">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>

              <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Click="SaveDebugBtn_Click" Width="216" Height="22" Margin="10,4,10,4">
                <Button.Effect><DropShadowEffect/></Button.Effect>
              </Button>
            </WrapPanel>
          </Border>

          <!-- Content -->
          <Grid Grid.Row="2" Margin="16,12,16,16">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Live Preview fills full height -->
            <GroupBox Header="Live Preview" Margin="0,0,16,0" BorderThickness="0"
                      FontWeight="Bold" Background="#FF16191F"
                      HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
              <GroupBox.Effect><DropShadowEffect/></GroupBox.Effect>

              <!-- Viewbox guarantees scale-to-fit; no overflow -->
              <Grid Background="Black" ClipToBounds="True">
                <Viewbox Stretch="Uniform" StretchDirection="Both" Margin="8" ClipToBounds="True">
                  <Image x:Name="LivePreview" Stretch="Fill"/>
                </Viewbox>

                <!-- overlay starts hidden -->
                <Border x:Name="OcrDetailsOverlay" Background="Black" Visibility="Collapsed" Margin="8" CornerRadius="2">
                  <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBlock x:Name="OcrDetailsText" FontSize="12" Foreground="#FF2B2F36"/>
                  </ScrollViewer>
                </Border>
              </Grid>
            </GroupBox>

            <!-- RIGHT: API Echo (top half) / Tribe Log (bottom half) / Button -->
            <Grid Grid.Column="1">
              <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <GroupBox x:Name="API_Echo_Box" Grid.Row="0" Header="API Echo" BorderThickness="0"
                        Background="#FF16191F" Padding="0" Margin="0,0,0,12"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <Grid Margin="8">
                  <TextBox x:Name="ApiEchoText" AcceptsReturn="True" IsReadOnly="True"
                           TextChanged="ApiEchoText_TextChanged" BorderThickness="0.5" Padding="6"
                           HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                </Grid>
              </GroupBox>

              <GroupBox x:Name="Tribe_Log_Output_Box" Grid.Row="1" Header="Tribe Log Text Output Testing"
                        BorderThickness="0" Background="#FF16191F" Padding="0" Margin="0,0,0,12"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <Grid Margin="8">
                  <TextBox x:Name="LogLineBox" AcceptsReturn="True"
                           Background="Black" BorderThickness="0.5" Padding="6"
                           HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                </Grid>
              </GroupBox>

              <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,0">
                <Button x:Name="SendPastedBtn" Content="Send Pasted Logs"
                        Click="SendParsedBtn_Click" Height="32" Width="200"/>
              </StackPanel>
            </Grid>
          </Grid>
        </Grid>
      </TabItem>

      <!-- ========== Settings ========== -->
      <TabItem Header="Settings" FontWeight="Bold" Padding="0" SnapsToDevicePixels="True">
        <TabItem.Effect><DropShadowEffect/></TabItem.Effect>

        <ScrollViewer VerticalScrollBarVisibility="Auto" Width="800" Height="750" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Margin="8" Orientation="Vertical">
            <GroupBox Header="API credentials" BorderThickness="0.5">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Channel ID" Grid.Row="0" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <TextBox x:Name="ChannelBox" Grid.Row="0" Grid.Column="1"/>

                <TextBlock Text="API Base URL" Grid.Row="1" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1"/>

                <TextBlock Text="API Key" Grid.Row="2" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <PasswordBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1"/>
              </Grid>
            </GroupBox>

            <GroupBox Header="Endpoint paths" BorderThickness="0.5">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="180"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="OCR path:" Grid.Row="0" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="OcrPathBox" Grid.Row="0" Grid.Column="1"/>

                <TextBlock Text="Screenshot ingest path:" Grid.Row="1" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="ScreenshotPathBox" Grid.Row="1" Grid.Column="1"/>

                <TextBlock Text="Log-line ingest path:" Grid.Row="2" Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}"/>
                <TextBox x:Name="LogLinePathBox" Grid.Row="2" Grid.Column="1"/>
              </Grid>
            </GroupBox>

            <GroupBox Header="Filters" BorderThickness="0.5">
              <UniformGrid Columns="2">
                <CheckBox x:Name="FilterTameDeathsBox"            Content="Tame deaths"/>
                <CheckBox x:Name="FilterTamesStarvingBox"          Content="Tames starving to death"/>
                <CheckBox x:Name="FilterStructDestroyedBox"        Content="Structures destroyed"/>
                <CheckBox x:Name="FilterStructAutoDecayBox"        Content="Structures auto decay"/>
                <CheckBox x:Name="FilterTribeMateDeathsBox"        Content="Tribemate deaths"/>
                <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"   Content="Tribe kills enemy tames"/>
                <CheckBox x:Name="FilterEnemyPlayerKillsBox"       Content="Enemy player kills"/>
                <CheckBox x:Name="FilterTribeDemolishBox"          Content="Tribemates demolishing structures"/>
                <CheckBox x:Name="FilterTribeFreezeTamesBox"       Content="Tribemates freezing tames"/>
              </UniformGrid>
            </GroupBox>

            <GroupBox Header="Overlay" BorderThickness="0.5">
              <StackPanel Orientation="Horizontal">
                <CheckBox x:Name="ShowOcrDetailsCheck"
                          Content="Show OCR details overlay on Capture"
                          Checked="ShowOcrDetailsCheck_Changed"
                          Unchecked="ShowOcrDetailsCheck_Changed"/>
              </StackPanel>
            </GroupBox>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
              <Button x:Name="SaveBtn" Content="Save" Click="SaveBtn_Click" BorderThickness="0"/>
            </StackPanel>
          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
