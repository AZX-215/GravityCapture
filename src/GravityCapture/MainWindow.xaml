<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture"
        MinWidth="1040" MinHeight="650"
        Height="720" Width="1060"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        SourceInitialized="Window_SourceInitialized"
        SizeChanged="Window_SizeChanged">

  <DockPanel Background="{DynamicResource BgBrush}">
    <!-- Status -->
    <Border DockPanel.Dock="Bottom" Padding="6,4"
            BorderBrush="{DynamicResource InputBorderBrush}" BorderThickness="1,1,1,0">
      <TextBlock x:Name="StatusText" Foreground="{DynamicResource TextMutedBrush}"/>
    </Border>

    <TabControl Background="{DynamicResource BgBrush}">
      <!-- Capture -->
      <TabItem Header="Capture" Background="{DynamicResource BgBrush}">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Background="{DynamicResource BgBrush}">
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Top controls: two-row responsive toolbar -->
            <Border Padding="10" CornerRadius="{DynamicResource CardRadius}"
                    BorderBrush="{DynamicResource InputBorderBrush}" BorderThickness="1">
              <StackPanel Orientation="Vertical" Background="{DynamicResource CardBrush}">
                <!-- Row 1 -->
                <WrapPanel ItemHeight="32" ItemWidth="Auto">
                  <TextBlock Text="Server" Margin="0,4,6,0" VerticalAlignment="Center"/>
                  <TextBox x:Name="ServerBox" Width="300" Margin="0,0,10,0"/>
                  <TextBlock Text="Tribe" Margin="0,4,6,0" VerticalAlignment="Center"/>
                  <TextBox x:Name="TribeBox" Width="200" Margin="0,0,10,0"/>
                  <Button x:Name="StartBtn" Content="Start" Click="StartBtn_Click"
                          Style="{DynamicResource SecondaryButton}" Margin="0,0,6,0"/>
                  <Button x:Name="StopBtn" Content="Stop" Click="StopBtn_Click"
                          Style="{DynamicResource SecondaryButton}" Margin="0,0,6,0"/>
                  <Button x:Name="SelectCropBtn" Content="Select Log Area…" Click="SelectCropBtn_Click"
                          Style="{DynamicResource SecondaryButton}" Margin="0,0,6,0"/>
                  <CheckBox x:Name="ShowOcrDetailsCheck" Content="Show OCR details" Margin="8,6,0,0"
                            Checked="ShowOcrDetailsCheck_Changed" Unchecked="ShowOcrDetailsCheck_Changed"/>
                </WrapPanel>

                <!-- Row 2 -->
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                  <WrapPanel Margin="0,8,0,0" ItemHeight="32">
                    <Button x:Name="OcrCropBtn" Content="OCR Crop → Paste" Click="OcrCropBtn_Click"
                            Style="{DynamicResource SecondaryButton}" Margin="0,0,6,0"/>
                    <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click"
                            Style="{DynamicResource SecondaryButton}" Margin="0,0,6,0"/>
                    <Button x:Name="SendParsedBtn" Content="Send Pasted Log Line" Click="SendParsedBtn_Click"
                            Style="{DynamicResource SecondaryButton}"/>
                  </WrapPanel>
                </ScrollViewer>
              </StackPanel>
            </Border>

            <!-- Preview + paste -->
            <Grid Grid.Row="1" Margin="0,10,0,0">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
              </Grid.ColumnDefinitions>

              <Border CornerRadius="{DynamicResource CardRadius}"
                      BorderBrush="{DynamicResource InputBorderBrush}" BorderThickness="1" Padding="10">
                <!-- Fill available space and scale -->
                <Grid>
                  <Image x:Name="LivePreview"
                         Stretch="Uniform" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                         SnapsToDevicePixels="True" UseLayoutRounding="True" />
                  <Border x:Name="OcrDetailsOverlay" Background="#66000000" Visibility="Collapsed" CornerRadius="8" Margin="6">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                      <TextBlock x:Name="OcrDetailsText" FontFamily="Consolas" TextWrapping="Wrap"/>
                    </ScrollViewer>
                  </Border>
                </Grid>
              </Border>

              <Border Grid.Column="1" Margin="10,0,0,0" CornerRadius="{DynamicResource CardRadius}"
                      BorderBrush="{DynamicResource InputBorderBrush}" BorderThickness="1" Padding="10">
                <DockPanel>
                  <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                    <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Click="SaveDebugBtn_Click"
                            Style="{DynamicResource SecondaryButton}" Margin="0,0,12,0"/>
                    <TextBlock Text="API echo:" Margin="0,6,6,0" Foreground="{DynamicResource TextMutedBrush}"/>
                    <TextBlock x:Name="ApiEchoText" Foreground="{DynamicResource TextBrush}" Margin="0,6,0,0"/>
                  </StackPanel>
                  <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBox x:Name="LogLineBox" AcceptsReturn="True" FontFamily="Consolas"
                             Foreground="{DynamicResource TextBrush}" Background="#111214" BorderThickness="0"
                             HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" MinHeight="260"/>
                  </ScrollViewer>
                </DockPanel>
              </Border>
            </Grid>
          </Grid>
        </ScrollViewer>
      </TabItem>

      <!-- Settings -->
      <TabItem Header="Settings" Background="{DynamicResource BgBrush}">
        <ScrollViewer VerticalScrollBarVisibility="Auto" Background="{DynamicResource BgBrush}">
          <Grid Margin="12">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row="0" Grid.ColumnSpan="2" Text="API credentials" FontWeight="Bold" Margin="0,0,0,8"/>

            <TextBlock Grid.Row="1" Grid.Column="0" Text="Channel ID:" Margin="0,6,8,6"/>
            <TextBox   Grid.Row="1" Grid.Column="1" x:Name="ChannelBox" Width="360"/>

            <TextBlock Grid.Row="2" Grid.Column="0" Text="API URL:" Margin="0,6,8,6"/>
            <TextBox   Grid.Row="2" Grid.Column="1" x:Name="ApiUrlBox"/>

            <TextBlock Grid.Row="3" Grid.Column="0" Text="API Key:" Margin="0,6,8,6"/>
            <PasswordBox Grid.Row="3" Grid.Column="1" x:Name="ApiKeyBox"/>

            <TextBlock Grid.Row="4" Grid.ColumnSpan="2" Text="Filters" FontWeight="Bold" Margin="0,16,0,6"/>

            <StackPanel Grid.Row="5" Grid.ColumnSpan="2" Orientation="Vertical">
              <CheckBox x:Name="FilterTameDeathsBox" Content="Tame deaths"/>
              <CheckBox x:Name="FilterTamesStarvingBox" Content="Tames starving to death"/>
              <CheckBox x:Name="FilterStructDestroyedBox" Content="Structures destroyed"/>
              <CheckBox x:Name="FilterStructAutoDecayBox" Content="Structures auto decay"/>
              <CheckBox x:Name="FilterTribeMateDeathsBox" Content="Tribemate deaths"/>
              <CheckBox x:Name="FilterTribeKillsEnemyTamesBox" Content="Tribe kills enemy tames"/>
              <CheckBox x:Name="FilterEnemyPlayerKillsBox" Content="Enemy player kills"/>
              <CheckBox x:Name="FilterTribeDemolishBox" Content="Tribemates demolishing structures"/>
              <CheckBox x:Name="FilterTribeFreezeTamesBox" Content="Tribemates freezing tames"/>
            </StackPanel>

            <StackPanel Grid.Row="6" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
              <Button x:Name="SaveBtn" Content="Save" Click="SaveBtn_Click" Style="{DynamicResource PrimaryButton}"/>
            </StackPanel>
          </Grid>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </DockPanel>
</Window>
