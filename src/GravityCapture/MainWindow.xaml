<Window
    x:Class="GravityCapture.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="av"
    Title="Gravity Capture"
    MinWidth="820" MinHeight="920"
    MaxWidth="820" MaxHeight="920"
    Background="{x:Null}"
    Loaded="Window_Loaded"
    Closing="Window_Closing"
    SourceInitialized="Window_SourceInitialized"
    SizeChanged="Window_SizeChanged"
    HorizontalContentAlignment="Stretch"
    VerticalContentAlignment="Stretch">

    <Grid Background="#FF16191F">

        <!-- window rows -->
        <Grid.RowDefinitions>
            <RowDefinition Height="64"/>   <!-- tabs -->
            <RowDefinition Height="110"/>  <!-- banner -->
            <RowDefinition Height="Auto"/> <!-- capture toolbar -->
            <RowDefinition Height="*"/>    <!-- page host -->
            <RowDefinition Height="28"/>   <!-- status -->
        </Grid.RowDefinitions>

        <!-- ================= TABS ================= -->
        <Grid Grid.Row="0"
              Margin="0,6,0,0"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              Height="48"
              Width="420">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="CaptureTabButton"
                    Grid.Column="0"
                    Content="Capture"
                    Click="CaptureTabButton_Click"
                    Margin="0,0,12,0"
                    Height="44"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Background="#FF3A3F47"
                    Foreground="White"
                    BorderThickness="0" />

            <Button x:Name="SettingsTabButton"
                    Grid.Column="1"
                    Content="Settings"
                    Click="SettingsTabButton_Click"
                    Margin="12,0,0,0"
                    Height="44"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Background="#FF2E333A"
                    Foreground="White"
                    BorderThickness="0" />
        </Grid>

        <!-- ================= BANNER ================= -->
        <Border Grid.Row="1"
                Background="#FF1B1E24"
                BorderBrush="#FF0F1013"
                BorderThickness="0,2,0,2"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center">
            <Image Source="pack://application:,,,/Assets/Gravity_Capture_App_Banner.png"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Stretch="Uniform"
                   Height="82"
                   Margin="0,6,0,6"/>
        </Border>

        <!-- ================= CAPTURE TOOLBAR ================= -->
        <Grid x:Name="CaptureToolbar"
              Grid.Row="2"
              Margin="14,4,14,4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- row 0 -->
            <TextBlock Text="Server"
                       Grid.Row="0" Grid.Column="0"
                       Foreground="Red"
                       FontFamily="Microsoft YaHei UI"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="0,0,6,0"/>
            <TextBox x:Name="ServerBox"
                     Grid.Row="0" Grid.Column="1"
                     MinWidth="240"
                     Height="28"
                     Margin="0,0,12,0"
                     Background="Black"
                     Foreground="White"
                     VerticalContentAlignment="Center"
                     TextChanged="ServerBox_TextChanged"/>
            <TextBlock Text="Tribe"
                       Grid.Row="0" Grid.Column="2"
                       Foreground="Red"
                       FontFamily="Microsoft YaHei UI"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="0,0,6,0"/>
            <TextBox x:Name="TribeBox"
                     Grid.Row="0" Grid.Column="3"
                     MinWidth="240"
                     Height="28"
                     Background="Black"
                     Foreground="White"
                     VerticalContentAlignment="Center"
                     TextChanged="TribeBox_TextChanged"/>

            <!-- row 1 -->
            <WrapPanel Grid.Row="1" Grid.ColumnSpan="4"
                       Margin="0,6,0,0"
                       Orientation="Horizontal">
                <Button x:Name="StartBtn"
                        Content="Start"
                        Click="StartBtn_Click"
                        Width="70"
                        Height="26"
                        Margin="0,0,6,0"/>
                <Button x:Name="StopBtn"
                        Content="Stop"
                        Click="StopBtn_Click"
                        Width="70"
                        Height="26"
                        Margin="0,0,12,0"/>
                <Button x:Name="SelectCropBtn"
                        Content="Select Log Area..."
                        Click="SelectCropBtn_Click"
                        Width="150"
                        Height="26"
                        Margin="0,0,6,0"/>
                <Button x:Name="OcrCropBtn"
                        Content="OCR Crop â†’ Paste"
                        Click="OcrCropBtn_Click"
                        Width="150"
                        Height="26"
                        Margin="0,0,6,0"/>
                <Button x:Name="OcrAndPostNowBtn"
                        Content="OCR &amp; Post Visible Now"
                        Click="OcrAndPostNowBtn_Click"
                        Width="170"
                        Height="26"
                        Margin="0,0,0,0"/>
            </WrapPanel>
        </Grid>

        <!-- ================= PAGE HOST ================= -->
        <Grid Grid.Row="3" Margin="8,2,8,4" x:Name="PageHost">

            <!-- ===== Capture page ===== -->
            <Grid x:Name="CapturePage" Visibility="Visible">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <!-- LEFT: Live preview -->
                <GroupBox Header="Live Preview"
                          Grid.Column="0"
                          Margin="0,0,10,0"
                          FontFamily="Microsoft YaHei UI"
                          Foreground="#FFD0D0D0"
                          Background="#FF1E2025"
                          BorderThickness="0.5"
                          BorderBrush="#FF394049">
                    <Grid Margin="6" ClipToBounds="True">
                        <Border Background="Black"
                                BorderBrush="#FF2B2F36"
                                BorderThickness="1"
                                Margin="0,18,0,0"
                                ClipToBounds="True">
                            <Grid>
                                <Image x:Name="LivePreview"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       SnapsToDevicePixels="True"/>
                                <!-- overlay now clear -->
                                <Border x:Name="OcrDetailsOverlay"
                                        Background="Transparent"
                                        Margin="4"
                                        Visibility="Collapsed"
                                        VerticalAlignment="Stretch"
                                        HorizontalAlignment="Stretch">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <TextBlock x:Name="OcrDetailsText"
                                                   FontFamily="Consolas"
                                                   FontSize="12"
                                                   Foreground="#FFF3F3F3"
                                                   TextWrapping="Wrap"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </GroupBox>

                <!-- RIGHT: stacked boxes -->
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <GroupBox x:Name="API_Echo_Box"
                              Grid.Row="0"
                              Header="API Echo"
                              FontFamily="Microsoft YaHei UI"
                              Foreground="#FFD0D0D0"
                              Background="#FF1E2025"
                              BorderThickness="0.5"
                              BorderBrush="#FF394049"
                              Margin="0,0,0,8">
                        <TextBox x:Name="ApiEchoText"
                                 Margin="6"
                                 Background="Black"
                                 Foreground="White"
                                 VerticalScrollBarVisibility="Auto"
                                 AcceptsReturn="True"
                                 TextChanged="ApiEchoText_TextChanged"/>
                    </GroupBox>

                    <GroupBox x:Name="Tribe_Log_Output_Box"
                              Grid.Row="1"
                              Header="Tribe Log Text Output Testing"
                              FontFamily="Microsoft YaHei UI"
                              Foreground="#FFD0D0D0"
                              Background="#FF1E2025"
                              BorderThickness="0.5"
                              BorderBrush="#FF394049"
                              Margin="0,0,0,8">
                        <Grid>
                            <TextBox x:Name="LogLineBox"
                                     Margin="6"
                                     Background="Black"
                                     Foreground="White"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     TextWrapping="Wrap"
                                     MinHeight="120"/>
                        </Grid>
                    </GroupBox>

                    <Button x:Name="SendPastedBtn"
                            Grid.Row="2"
                            Content="Send Pasted Logs"
                            Width="180"
                            Height="34"
                            HorizontalAlignment="Right"
                            Margin="0,0,6,0"
                            Click="SendPastedBtn_Click"/>
                </Grid>
            </Grid>

            <!-- ===== Settings page ===== -->
            <ScrollViewer x:Name="SettingsPage"
                          Visibility="Collapsed"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Margin="0"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch">
                <StackPanel Margin="6" HorizontalAlignment="Stretch" MaxWidth="760">

                    <GroupBox Header="API credentials" BorderThickness="0.5" HorizontalAlignment="Stretch">
                        <Grid Margin="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Channel ID" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Foreground="#FFB5B9C0"/>
                            <TextBox x:Name="ChannelBox" Grid.Row="0" Grid.Column="1"/>
                            <TextBlock Text="API Base URL" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Foreground="#FFB5B9C0"/>
                            <TextBox x:Name="ApiUrlBox" Grid.Row="1" Grid.Column="1"/>
                            <TextBlock Text="API Key" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Foreground="#FFB5B9C0"/>
                            <PasswordBox x:Name="ApiKeyBox" Grid.Row="2" Grid.Column="1"/>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="Endpoint paths" BorderThickness="0.5" Margin="0,6,0,0" HorizontalAlignment="Stretch">
                        <Grid Margin="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="OCR path:" Grid.Row="0" Grid.Column="0" Foreground="#FFB5B9C0"/>
                            <TextBox x:Name="OcrPathBox" Grid.Row="0" Grid.Column="1"/>
                            <TextBlock Text="Screenshot ingest path:" Grid.Row="1" Grid.Column="0" Foreground="#FFB5B9C0"/>
                            <TextBox x:Name="ScreenshotPathBox" Grid.Row="1" Grid.Column="1"/>
                            <TextBlock Text="Log-line ingest path:" Grid.Row="2" Grid.Column="0" Foreground="#FFB5B9C0"/>
                            <TextBox x:Name="LogLinePathBox" Grid.Row="2" Grid.Column="1"/>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="Filters" BorderThickness="0.5" Margin="0,6,0,0" HorizontalAlignment="Stretch">
                        <UniformGrid Columns="2">
                            <CheckBox x:Name="FilterTameDeathsBox" Content="Tame deaths"/>
                            <CheckBox x:Name="FilterTamesStarvingBox" Content="Tames starving to death"/>
                            <CheckBox x:Name="FilterStructDestroyedBox" Content="Structures destroyed"/>
                            <CheckBox x:Name="FilterStructAutoDecayBox" Content="Structures auto decay"/>
                            <CheckBox x:Name="FilterTribeMateDeathsBox" Content="Tribemate deaths"/>
                            <CheckBox x:Name="FilterTribeKillsEnemyTamesBox" Content="Tribe kills enemy tames"/>
                            <CheckBox x:Name="FilterEnemyPlayerKillsBox" Content="Enemy player kills"/>
                            <CheckBox x:Name="FilterTribeDemolishBox" Content="Tribemates demolishing structures"/>
                            <CheckBox x:Name="FilterTribeFreezeTamesBox" Content="Tribemates freezing tames"/>
                        </UniformGrid>
                    </GroupBox>

                    <GroupBox Header="Overlay" BorderThickness="0.5" Margin="0,6,0,0" HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal">
                            <CheckBox x:Name="ShowOcrDetailsCheck"
                                      Content="Show OCR details overlay on Capture"
                                      Checked="ShowOcrDetailsCheck_Changed"
                                      Unchecked="ShowOcrDetailsCheck_Changed"/>
                        </StackPanel>
                    </GroupBox>

                    <StackPanel Orientation="Horizontal" Margin="0,10,0,4">
                        <Button x:Name="SaveBtn" Content="Save" Click="SaveBtn_Click" Width="90" Margin="0,0,8,0"/>
                        <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Click="SaveDebugBtn_Click" Width="140"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- ================= STATUS ================= -->
        <Border Grid.Row="4"
                BorderBrush="#FF2B2F36"
                BorderThickness="0,1,0,0"
                Background="#FF1B1E24"
                Padding="6,4,6,2">
            <TextBlock x:Name="StatusText"
                       Foreground="White"
                       FontFamily="Segoe UI"
                       FontSize="11"
                       Text=""/>
        </Border>
    </Grid>
</Window>
