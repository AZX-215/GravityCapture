<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture"
        Width="1060" Height="720"
        Background="{DynamicResource BgBrush}"
        Foreground="{DynamicResource TextBrush}"
        SnapsToDevicePixels="True" UseLayoutRounding="True">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Tabs -->
    <TabControl Grid.Row="0">

      <!-- ============ Capture tab ============ -->
      <TabItem Header="Capture">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Toolbar -->
          <DockPanel Grid.Row="0" LastChildFill="True">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
              <Label Content="Server" VerticalAlignment="Center"/>
              <TextBox x:Name="ServerBox" Width="260" ToolTip="Server name or id"/>
              <Label Content="Tribe" VerticalAlignment="Center"/>
              <TextBox x:Name="TribeBox" Width="190"/>

              <Button x:Name="StartBtn_" Content="Start" Click="StartBtn_Click"/>
              <Button x:Name="StopBtn_"  Content="Stop"  Click="StopBtn_Click"/>
              <Button x:Name="SelectAreaBtn" Content="Select Log Area..." Click="SelectAreaBtn_Click"/>
              <CheckBox x:Name="ShowOcrDetailsCheck" Content="Show OCR details" Margin="12,0,0,0"
                        Checked="ShowOcrDetailsCheck_Changed" Unchecked="ShowOcrDetailsCheck_Changed"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
              <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Click="OcrCropBtn_Click"/>
              <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click"/>
              <Button x:Name="SendParsedBtn_" Content="Send Pasted Log Line" Click="SendParsedBtn_Click"/>
            </StackPanel>
          </DockPanel>

          <!-- Body -->
          <Grid Grid.Row="1" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Live preview (scales to fit) -->
            <Border Grid.Column="0" Padding="8">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Label Content="Live preview" />
                <Border Grid.Row="1" Padding="6" Background="{DynamicResource BgBrush}">
                  <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                    <!-- Image host for preview; replace source from code-behind if needed -->
                    <Image x:Name="PreviewImage"
                           Stretch="Uniform"
                           SnapsToDevicePixels="True"
                           RenderOptions.BitmapScalingMode="Fant"
                           RenderOptions.EdgeMode="Aliased"/>
                  </ScrollViewer>
                </Border>
              </Grid>
            </Border>

            <!-- Right side: paste + API echo -->
            <Border Grid.Column="1" Padding="8">
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,6">
                  <Button x:Name="SaveDebugBtn_" Content="Save debug ZIP" Click="SaveDebugBtn_Click"/>
                  <Label Content="API echo:" Margin="12,0,0,0"/>
                  <TextBlock x:Name="Status" VerticalAlignment="Center" Foreground="{DynamicResource MutedTextBrush}" />
                </StackPanel>

                <Grid Grid.Row="1">
                  <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <!-- API echo / log -->
                  <TextBox x:Name="ApiEchoBox"
                           Grid.Row="0"
                           AcceptsReturn="True"
                           TextWrapping="Wrap"
                           VerticalScrollBarVisibility="Auto"
                           HorizontalScrollBarVisibility="Auto"/>

                  <!-- Paste area for a tribe log line -->
                  <StackPanel Grid.Row="1" Orientation="Vertical" Margin="0,8,0,0">
                    <Label Content="Paste a tribe log line:"/>
                    <TextBox x:Name="LogLineBox"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="96"
                             VerticalScrollBarVisibility="Auto"/>
                  </StackPanel>
                </Grid>
              </Grid>
            </Border>
          </Grid>
        </Grid>
      </TabItem>

      <!-- ============ Settings tab ============ -->
      <TabItem Header="Settings">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- API credentials + endpoints -->
          <StackPanel Grid.Column="0" Orientation="Vertical">
            <TextBlock Text="API credentials" FontWeight="Bold" Margin="0,0,0,6"/>

            <Label Content="Channel ID:"/>
            <TextBox x:Name="ChannelBox"/>

            <Label Content="API Base URL:"/>
            <TextBox x:Name="ApiUrlBox" ToolTip="e.g. https://screenshots-api-stage-production.up.railway.app"/>

            <Label Content="API Key:"/>
            <TextBox x:Name="ApiKeyBox"/>

            <TextBlock Text="Endpoint paths" FontWeight="Bold" Margin="0,12,0,6"/>
            <Label Content="OCR path:"/>
            <!-- New default: /api/ocr/extract -->
            <TextBox x:Name="OcrPathBox" Text="/api/ocr/extract"/>

            <Label Content="Screenshot ingest path:"/>
            <TextBox x:Name="ScreenshotPathBox" Text="/ingest/screenshot"/>

            <Label Content="Log-line ingest path:"/>
            <TextBox x:Name="LogIngestPathBox" Text="/ingest/log-line"/>

            <Button x:Name="SaveBtn_" Content="Save" Margin="0,12,0,0" Width="88" Click="SaveBtn_Click"/>
          </StackPanel>

          <!-- Filters -->
          <StackPanel Grid.Column="1" Orientation="Vertical">
            <TextBlock Text="Filters" FontWeight="Bold" Margin="0,0,0,6"/>

            <!-- The names below are chosen to match common code-behind expectations -->
            <CheckBox x:Name="FilterTameDeathsBox"            Content="Tame deaths"/>
            <CheckBox x:Name="FilterTamesStarvingBox"         Content="Tames starving to death"/>
            <CheckBox x:Name="FilterStructDestroyedBox"       Content="Structures destroyed"/>
            <CheckBox x:Name="FilterStructAutoDecayBox"       Content="Structures auto decay"/>
            <CheckBox x:Name="FilterTribemateDeathsBox"       Content="Tribemate deaths"/>
            <CheckBox x:Name="FilterTribeKillsEnemyTamesBox"  Content="Tribe kills enemy tames"/>
            <CheckBox x:Name="FilterEnemyPlayerKillsBox"      Content="Enemy player kills"/>
            <CheckBox x:Name="FilterTribemateDemolishBox"     Content="Tribemates demolishing structures"/>
            <CheckBox x:Name="FilterTribeFreezeTamesBox"      Content="Tribemates freezing tames"/>
          </StackPanel>
        </Grid>
      </TabItem>

    </TabControl>

    <!-- Status bar -->
    <DockPanel Grid.Row="1" LastChildFill="True" Margin="8,0,8,8">
      <TextBlock Text="{Binding ElementName=Status, Path=Text}" />
      <TextBlock Text="  ARK window: " Foreground="{DynamicResource MutedTextBrush}"/>
      <TextBlock x:Name="ArkWindowName" Foreground="{DynamicResource MutedTextBrush}"/>
    </DockPanel>
  </Grid>
</Window>
