<Window x:Class="GravityCapture.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gravity Capture"
        MinWidth="820" MinHeight="920"
        MaxWidth="820" MaxHeight="920"
        Background="#FF2B2F36"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        SourceInitialized="Window_SourceInitialized"
        SizeChanged="Window_SizeChanged">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0*"/>
            <ColumnDefinition Width="20*"/>
            <ColumnDefinition Width="21*"/>
            <ColumnDefinition Width="0*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="13*"/>
            <RowDefinition Height="426*"/>
            <RowDefinition Height="427*"/>
            <RowDefinition Height="38"/>
        </Grid.RowDefinitions>

        <!-- Tabs -->
        <TabControl Grid.Row="0" Grid.RowSpan="3" SelectionChanged="TabControl_SelectionChanged" Margin="-1,0,1,2" Grid.ColumnSpan="3">
            <TabControl.Template>
                <ControlTemplate TargetType="TabControl">
                    <Grid SnapsToDevicePixels="True">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- headers -->
                            <RowDefinition Height="Auto"/> <!-- banner -->
                            <RowDefinition Height="*"/>    <!-- content -->
                        </Grid.RowDefinitions>

                        <TabPanel Grid.Row="0"
                                  IsItemsHost="True"
                                  Background="#FF2B2F36"/>

                        <Border Grid.Row="1" Background="#FF2B2F36" Margin="0,0,0,6">
                            <Border.Effect>
                                <DropShadowEffect/>
                            </Border.Effect>
                            <Image Stretch="None"
                                   SnapsToDevicePixels="True"
                                   UseLayoutRounding="True"
                                   Source="pack://application:,,,/GravityCapture;component/Assets/Gravity_Capture_App_Banner.png">
                                <Image.Effect>
                                    <DropShadowEffect/>
                                </Image.Effect>
                            </Image>
                        </Border>

                        <Border Grid.Row="2"
                                Background="#FF2B2F36"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter x:Name="PART_SelectedContentHost"
                                              ContentSource="SelectedContent"/>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </TabControl.Template>

            <!-- ======================= Capture ======================= -->
            <TabItem Header="Capture" Width="400" HorizontalAlignment="Left" VerticalAlignment="Center" Height="32">
                <TabItem.Effect>
                    <DropShadowEffect/>
                </TabItem.Effect>
                <Grid Margin="-1,0,1,0" Background="Black">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="Black" Padding="9" Margin="3,0,-3,0">
                        <WrapPanel VerticalAlignment="Top" ItemHeight="32" Margin="0,-2,0,0">
                            <TextBlock Text="Server" Margin="9,0,9,0"
                                       Foreground="Red" FontFamily="Microsoft YaHei UI" FontSize="14" VerticalAlignment="Center"/>
                            <TextBox x:Name="ServerBox" Width="320" Margin="9,0,9,0" TextChanged="ServerBox_TextChanged" Height="28" HorizontalAlignment="Right" VerticalAlignment="Bottom"/>

                            <TextBlock Text="Tribe" Margin="9,0,9,0"
                                       Foreground="Red" FontFamily="Microsoft YaHei UI" FontSize="14" VerticalAlignment="Center"/>
                            <TextBox x:Name="TribeBox" Width="320" Padding="6,6,6,6" ScrollViewer.CanContentScroll="True" Height="28" Margin="9,0,9,0" HorizontalAlignment="Right" VerticalAlignment="Bottom"/>

                            <Button x:Name="StartBtn" Content="Start" Click="StartBtn_Click" Margin="60,0,4,0" Width="52" HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="22"/>
                            <Button x:Name="StopBtn" Content="Stop" Click="StopBtn_Click" Margin="4,0,60,0" FontFamily="Microsoft YaHei UI" Width="52" HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="22"/>
                            <Button x:Name="SelectCropBtn" Content="Select Log Area..." Click="SelectCropBtn_Click" FontFamily="Microsoft YaHei UI" Width="164" HorizontalContentAlignment="Stretch" HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="22" Margin="8,0,4,0">
                                <Button.Effect>
                                    <DropShadowEffect/>
                                </Button.Effect>
                            </Button>

                            <Button x:Name="OcrCropBtn" Content="OCR Crop â†’ Paste" Click="OcrCropBtn_Click" FontFamily="Microsoft YaHei UI" Width="164" HorizontalContentAlignment="Stretch" HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="22" Margin="4,0,8,0"/>
                            <!-- keep only ONE OcrAndPostNowBtn -->
                            <Button x:Name="OcrAndPostNowBtn" Content="OCR &amp; Post Visible Now" Click="OcrAndPostNowBtn_Click" Padding="9,0,9,0" Grid.IsSharedSizeScope="True" FontFamily="Microsoft YaHei" Margin="8,2,9,0" HorizontalContentAlignment="Stretch"/>

                            <Button x:Name="SaveDebugBtn" Content="Save debug ZIP" Click="SaveDebugBtn_Click" FontFamily="Microsoft YaHei UI" Width="780" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Center" Height="26" HorizontalAlignment="Center" Margin="9,2,9,-8" VerticalAlignment="Center"/>
                        </WrapPanel>
                    </Border>

                    <Grid Grid.Row="1" Margin="8,9,8,7">
                        <Grid.Background>
                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                <GradientStop Color="Black" Offset="0.143"/>
                                <GradientStop Color="#FF7C7C7C" Offset="0.76"/>
                                <GradientStop Color="#FF7C7C7C" Offset="1"/>
                            </LinearGradientBrush>
                        </Grid.Background>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="4*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Header="Live Preview" Margin="8" BorderThickness="0" FontFamily="Microsoft YaHei UI" BorderBrush="Black" Foreground="#FFD0D0D0" FontWeight="Bold">
                            <GroupBox.Effect>
                                <DropShadowEffect/>
                            </GroupBox.Effect>
                            <Grid>
                                <Image x:Name="LivePreview" Stretch="Uniform"/>
                                <Border x:Name="OcrDetailsOverlay"
                                        Background="Black"
                                        Visibility="Collapsed"
                                        Margin="2" CornerRadius="2">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <TextBlock x:Name="OcrDetailsText"
                                                   FontFamily="Microsoft YaHei Light" FontSize="12"
                                                   Foreground="#FF2B2F36"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </GroupBox>

                        <Grid Grid.Column="1" Margin="8,8,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <GroupBox x:Name="API_Echo_Box" Header="API Echo" Margin="10,0,8,0" Height="96" FontFamily="Microsoft YaHei UI" BorderThickness="0" Foreground="#FFD0D0D0" BorderBrush="Black" FontWeight="Bold">
                                <GroupBox.Effect>
                                    <DropShadowEffect/>
                                </GroupBox.Effect>
                                <TextBox x:Name="ApiEchoText"
                                         FontFamily="Consolas" FontSize="12"
                                         AcceptsReturn="True"
                                         IsReadOnly="True" Height="58" VerticalAlignment="Center" TextChanged="ApiEchoText_TextChanged" SelectionBrush="#FFAB1212" BorderThickness="0">
                                    <TextBox.Effect>
                                        <DropShadowEffect/>
                                    </TextBox.Effect>
                                </TextBox>
                            </GroupBox>

                            <GroupBox Header="Tribe Log Text Output Testing" Margin="10,10,8,8" FontFamily="Microsoft YaHei UI" BorderThickness="0" Grid.Row="1" BorderBrush="Black" Foreground="White" FontWeight="Bold">
                                <GroupBox.Effect>
                                    <DropShadowEffect/>
                                </GroupBox.Effect>
                                <Grid Height="281">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBox x:Name="LogLineBox"
                                             FontFamily="Microsoft YaHei UI" FontSize="12"
                                             AcceptsReturn="True"
                                             MinHeight="120" UseLayoutRounding="False" Height="253" Text=""
                                             Grid.RowSpan="2" SelectionBrush="#FFAB1212" VerticalAlignment="Top" BorderThickness="0">
                                        <TextBox.Effect>
                                            <DropShadowEffect/>
                                        </TextBox.Effect>
                                    </TextBox>

                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button x:Name="SendPastedBtn"
                                                Content="Send Pasted Logs"
                                                Click="SendParsedBtn_Click" Padding="9,2,9,2" Margin="9" Height="30">
                                            <Button.Effect>
                                                <DropShadowEffect/>
                                            </Button.Effect>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- ======================= Settings ======================= -->
            <!-- (rest of Settings tab remains unchanged) -->

        </TabControl>

        <Border Grid.Row="3" Background="#22252B" Padding="6,4" Grid.ColumnSpan="3">
            <TextBlock x:Name="StatusText" Foreground="{DynamicResource InputBgColor}"/>
        </Border>
    </Grid>
</Window>
